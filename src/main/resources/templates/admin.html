<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<html lang="en">
<html>
<head>
    <meta charset="UTF-8">
    <title>🛏Picuang - 永久免费 | 免登录图床</title>
    <link href="/favicon.png" rel="icon">

    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap/cover.css" rel="stylesheet">

    <script src="/js/jquery.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/js/clipboard.js"></script>

    <meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<div class="site-wrapper">
    <div class="site-wrapper-inner">
        <div class="cover-container">
            <div class="masthead clearfix">
                <div class="inner">
                    <a href="/"><h3 class="masthead-brand">必床 Picuang</h3></a>
                    <nav>
                        <ul class="nav masthead-nav">
                            <li id="logout" style="display: none"><a href="javascript:logout();">注销</a></li>
                            <li><a href="/">上传</a></li>
                            <li><a href="/history">历史</a></li>
                            <li class="active"><a href="/admin">管理</a></li>
                        </ul>
                    </nav>
                </div>
            </div>

            <div class="inner cover">
                <div id="admin" style="margin-top: 36px; margin-bottom: 36px;">
                    <div id="message"></div>
                    <div id="config" style="display: none">
                        <div class="row" id="config-row">
                        </div>
                        <hr style="filter: alpha(opacity=100,finishopacity=0,style=3); margin-top: 36px; margin-bottom: 36px;" width="95%" color="#6f5499" size="3" />
                        <div class="config-buttons">
                            <div class="btn-group btn-group-justified" role="group" aria-label="...">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-default" onclick="exportConfig()">导出配置</button>
                                </div>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-primary">仅允许管理员上传 (当前：否)</button>
                                </div>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-default">导入配置</button>
                                </div>
                            </div>
                        </div>
                        <hr style="filter: alpha(opacity=100,finishopacity=0,style=3); margin-top: 36px; margin-bottom: 36px;" width="95%" color="#6f5499" size="3" />
                        <div class="help">
                            <div class="col-md-12">
                                <h4>Q：如何修改我的上传大小限制？</h4>
                                <p>A：请编辑文件 "<span th:text="${appConfLocation}"></span>"<br>
                                    修改 "spring.servlet.multipart.max-file-size" 和 "spring.servlet.multipart.max-request-size" 选项<br>
                                    假如限制大小为10MB，则将两个键的值全部改为"10MB"，重启服务器后就会生效。<br>
                                    如果重启服务器后不生效或仍有问题，请参阅<a href="https://github.com/AdlerED/Picuang#rotating_light-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" target="_blank"><b>这里</b></a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                function exportConfig() {
                    window.open("/api/admin/export");
                }

                $(function () {
                    axios.get('/api/admin/init')
                        .then(function (response) {
                                if (response.data.code === 500) {
                                    $("#message").html("管理密码未设置，无法进入控制台！<br>请编辑文件 '" + response.data.data + "'<br>中 'password' 的值，然后重启服务端。");
                                } else {
                                    axios.get('/api/admin/check')
                                        .then(function (response) {
                                                if (response.data.code === 200) {
                                                    showConfig();
                                                } else {
                                                    showLogin();
                                                }
                                            }
                                        );
                                }
                            }
                        );
                });

                function adminLogin() {
                    var password = $("#admin-password").val();
                    var data = new FormData();
                    data.append("password", password);
                    axios.post('/api/admin/login', data)
                        .then(function (response) {
                                if (response.data.code === 200) {
                                    $("#admin-password").css("border-color", "green");
                                    $("#admin-button").css("border-color", "green");
                                    $("#admin-icon").removeClass();
                                    $("#admin-icon").addClass("glyphicon glyphicon-ok");
                                    $("#admin-password").hide(100);
                                    $("#admin-button").hide(100);
                                    showConfig();
                                } else {
                                    $("#admin-password").css("border-color", "red");
                                    $("#admin-button").css("border-color", "red");
                                    $("#admin-icon").removeClass();
                                    $("#admin-icon").addClass("glyphicon glyphicon-remove");
                                }
                            }
                        );
                }

                function logout() {
                    axios.get('/api/admin/logout')
                        .then(function (response) {
                                location.href = "/";
                            }
                        );
                }

                function showLogin() {
                    $("#message").html("<div class='row'><div class='col-lg-12'><div class='input-group'><input id='admin-password' class='form-control' placeholder='请输入管理员密码' type='text'><span class='input-group-btn'><button id='admin-button' class='btn btn-default' type='button' onclick='adminLogin()'><i id='admin-icon' class='glyphicon glyphicon-record'></i></button></span></div></div></div>");
                    $("#admin-password").keyup(function (event) {
                        if (event.keyCode === 13) {
                            adminLogin();
                        }
                    });
                }

                function showConfig() {
                    axios.get('/api/admin/getConf?conf=imageUploadedCount')
                        .then(function (response) {
                            $("#config-row").prepend("<div class='col-lg-6'><div class='input-group'><span class='input-group-addon' style='text-shadow: none !important;'>累计存储图片数</span><input id='imageUploadedCount-input' aria-label='...' class='form-control' type='text' value='" + response.data + "'><span class='input-group-btn'><button class='btn btn-default' type='button' onclick='editConfig(\"imageUploadedCount\")'>修改</button></span></div></div>");
                        });
                    axios.get('/api/admin/getConf?conf=password')
                        .then(function (response) {
                            $("#config-row").prepend("<div class='col-lg-6'><div class='input-group'><span class='input-group-addon' style='text-shadow: none !important;'>修改管理员密码</span><input id='password-input' aria-label='...' class='form-control' type='text' value='" + response.data + "'><span class='input-group-btn'><button class='btn btn-default' type='button' onclick='editConfig(\"password\")'>修改</button></span></div></div>");
                        });
                    $("#logout").fadeIn(200);
                    $("#config").fadeIn(100);
                }

                function editConfig(sheet) {
                    var value = $("#" + sheet + "-input").val();
                    axios.get('/api/admin/setConf?conf=' + sheet + '&value=' + value);
                    sendInnerNotify(sheet + " 的值已成功修改为：" + value);
                }
            </script>

            <div class="mastfoot">
                <div class="inner">
                    <p>
                        <script src="https://js.users.51.la/20181641.js" type="text/javascript"></script>
                        <br>
                        <a href="http://beian.miit.gov.cn" style="text-decoration: none;"
                           target="_blank">京ICP备18063791号</a>
                        <br>
                        <a href="https://github.com/AdlerED" style="text-decoration: none;" target="_blank"><strong>GitHub:
                            AdlerED</strong></a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/js/user/clipboard-control.js"></script>
<script src="/js/user/click-listen.js"></script>
<script src="/js/user/common-queue.js"></script>
<script src="/js/user/drag-and-drop.js"></script>
<script src="/js/user/on-paste.js"></script>
<script src="/js/user/notify.js"></script>
<script src="/js/d-toast.min.js"></script>
<script src="/js/axios.min.js"></script>
<script src="/js/fantastic-progress-bar-bootstrap.js"></script>
</body>
</html>